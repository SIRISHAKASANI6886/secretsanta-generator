pipeline {
    agent { label 'master'}
    tools{
       // jdk 'jdk11'
        maven 'maven3'
    }
    environment{
        SCANNER_HOME=  'sonar-scanner'
    }

    stages {
        stage('git-checkout') {
            steps {
                git 'https://github.com/jaiswaladi246/secretsanta-generator.git'
            }
        }

        stage('Code-Compile') {
            steps {
               sh "mvn clean compile"
            }
        }
        
        stage('Unit Tests') {
            steps {
               sh "mvn test"
            }
        }
           stage("Sonarqube Analysis") {
    steps {
        withSonarQubeEnv('sonarqubeserver') {
            sh '''export PATH="/opt/sonar-scanner/bin:$PATH" 
                /opt/sonar-scanner/bin/sonar-scanner \
                  -Dsonar.projectKey=sonar1 \
                  -Dsonar.projectName="sonar1" \
                  -Dsonar.sources=. \
                  -Dsonar.java.binaries=.
            '''
                    
    
                } 
            }
        }
        
            stage('complie') {
       steps{
            sh 'mvn clean install'
            }
          }
          stage("upload arifact"){
              steps{
                  nexusArtifactUploader(
                    artifacts: [[
                        artifactId: 'secretsanta',
                        classifier: '',
                        file: 'target/secretsanta-0.0.1-SNAPSHOT.jar',
                        type: 'jar'
                    ]],
                    credentialsId: 'nexusadmin',
                    groupId: 'com.notthebest',
                    nexusUrl: '192.168.31.70:8081',
                    nexusVersion: 'nexus3',
                    protocol: 'http',
                    repository: 'maven-snapshots',  
                    version: '0.0.1-SNAPSHOT'
                )
              }
          }
       }
     }